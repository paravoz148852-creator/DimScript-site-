<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>DimScript</title>
  <link rel="stylesheet" href="style.css">
  <!-- –î–æ–±–∞–≤–ª—è–µ–º Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</head>
<body>

<h1>DimScript</h1>

<div id="editor">
  <textarea id="code" placeholder="–í–≤–æ–¥–∏ –∫–æ–º–∞–Ω–¥—ã —Å—é–¥–∞..."></textarea>
  <br>
  <button onclick="runCode()">‚ñ∂ –ó–∞–ø—É—Å—Ç–∏—Ç—å</button>
  <button onclick="showImageManager()">üñºÔ∏è –ú–µ–Ω–µ–¥–∂–µ—Ä –∫–∞—Ä—Ç–∏–Ω–æ–∫</button>
  <button onclick="exportProject()">üíæ –≠–∫—Å–ø–æ—Ä—Ç –ø—Ä–æ–µ–∫—Ç–∞</button>
  <button onclick="document.getElementById('fileInput').click()">üìÇ –ò–º–ø–æ—Ä—Ç –ø—Ä–æ–µ–∫—Ç–∞</button>
  <button onclick="showCommunity()">üåê –°–æ–æ–±—â–µ—Å—Ç–≤–æ</button>
  <button onclick="showNeuroGenerator()">üß† –ù–µ–π—Ä–æ-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä</button>
  <input type="file" id="fileInput" accept=".dimscript">
</div>

<button id="backBtn" onclick="goBack()">üîô –ù–∞–∑–∞–¥</button>

<div id="output"></div>

<div id="imageManager">
  <div id="imageManagerContent">
    <h2>–ú–µ–Ω–µ–¥–∂–µ—Ä –∫–∞—Ä—Ç–∏–Ω–æ–∫</h2>
    <input type="file" id="imageUpload" accept="image/*" style="display: none;">
    <button onclick="document.getElementById('imageUpload').click()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫—É</button>
    <button onclick="hideImageManager()">‚úñÔ∏è –ó–∞–∫—Ä—ã—Ç—å</button>
    <div id="imageGallery"></div>
  </div>
</div>

<div id="community">
  <div id="communityContent">
    <h2>–°–æ–æ–±—â–µ—Å—Ç–≤–æ DimScript</h2>
    <button onclick="hideCommunity()">‚úñÔ∏è –ó–∞–∫—Ä—ã—Ç—å</button>
    
    <div id="publishSection">
      <h3>–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç</h3>
      <input type="text" id="projectName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞" style="width: 300px; padding: 8px; margin: 5px; background: #111; color: #00ff88; border: 1px solid #00ff88;">
      <input type="text" id="authorName" placeholder="–í–∞—à–µ –∏–º—è" style="width: 200px; padding: 8px; margin: 5px; background: #111; color: #00ff88; border: 1px solid #00ff88;">
      <br>
      <textarea id="projectDescription" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞" style="width: 100%; height: 60px; background: #111; color: #00ff88; border: 1px solid #00ff88; padding: 8px; margin: 5px;"></textarea>
      <br>
      <button onclick="publishProject()">üöÄ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
    </div>
    
    <div id="projectsList">
      <h3>–ü—Ä–æ–µ–∫—Ç—ã —Å–æ–æ–±—â–µ—Å—Ç–≤–∞</h3>
      <div id="projectsContainer"></div>
    </div>
  </div>
</div>

<div id="neuroGenerator">
  <div id="neuroContent">
    <h2>üß† –ù–µ–π—Ä–æ-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–æ–µ–∫—Ç–æ–≤</h2>
    <button onclick="hideNeuroGenerator()">‚úñÔ∏è –ó–∞–∫—Ä—ã—Ç—å</button>
    
    <div id="neuroSection">
      <textarea id="neuroPrompt" placeholder="–û–ø–∏—à–∏—Ç–µ, –∫–∞–∫–æ–π –ø—Ä–æ–µ–∫—Ç –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–æ–∑–¥–∞—Ç—å. –ù–∞–ø—Ä–∏–º–µ—Ä: '–°–æ–∑–¥–∞–π –∫–Ω–æ–ø–∫—É –∫–æ—Ç–æ—Ä–∞—è –º–µ–Ω—è–µ—Ç —Ü–≤–µ—Ç' –∏–ª–∏ '–°–¥–µ–ª–∞–π –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ—Ä —Å –ø—Ä—ã–∂–∫–∞–º–∏'" style="width: 100%; height: 100px; background: #111; color: #00ff88; border: 1px solid #00ccff; padding: 10px; margin: 10px 0; font-family: monospace;"></textarea>
      <br>
      
      <div id="neuroOptions">
        <label>
          <input type="checkbox" id="addComments" checked>
          –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –∫–æ–¥
        </label>
        <br>
        <label>
          <input type="checkbox" id="addDemoImages">
          –î–æ–±–∞–≤–∏—Ç—å –¥–µ–º–æ-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        </label>
        <br>
        <label>
          –°–ª–æ–∂–Ω–æ—Å—Ç—å:
          <select id="complexityLevel">
            <option value="simple">–ü—Ä–æ—Å—Ç–∞—è</option>
            <option value="medium" selected>–°—Ä–µ–¥–Ω—è—è</option>
            <option value="complex">–°–ª–æ–∂–Ω–∞—è</option>
          </select>
        </label>
      </div>
      
      <br>
      <button onclick="generateWithAI()" id="generateBtn">üöÄ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç</button>
      <div id="neuroStatus" style="margin-top: 10px; color: #00ccff;"></div>
    </div>
    
    <div id="neuroExamples" style="margin-top: 30px; border-top: 1px solid #00ff88; padding-top: 20px;">
      <h3>–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤:</h3>
      <div class="example" onclick="document.getElementById('neuroPrompt').value = '–°–æ–∑–¥–∞–π –∫–Ω–æ–ø–∫—É –∫–æ—Ç–æ—Ä–∞—è –º–µ–Ω—è–µ—Ç —Ü–≤–µ—Ç –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏'" style="cursor: pointer; padding: 8px; margin: 5px; background: #1a1a1a; border: 1px solid #00ff88;">
        –ö–Ω–æ–ø–∫–∞ —Å –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º —Ü–≤–µ—Ç–∞
      </div>
      <div class="example" onclick="document.getElementById('neuroPrompt').value = '–°–¥–µ–ª–∞–π –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ—Ä —Å –ø—Ä—ã–∂–∫–∞–º–∏ –∏ —Å–±–æ—Ä–æ–º –º–æ–Ω–µ—Ç'" style="cursor: pointer; padding: 8px; margin: 5px; background: #1a1a1a; border: 1px solid #00ff88;">
        –ü—Ä–æ—Å—Ç–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ—Ä
      </div>
      <div class="example" onclick="document.getElementById('neuroPrompt').value = '–°–æ–∑–¥–∞–π –∞–Ω–∏–º–∞—Ü–∏—é –¥–≤–∏–∂—É—â–µ–≥–æ—Å—è –æ–±—ä–µ–∫—Ç–∞ –ø–æ —ç–∫—Ä–∞–Ω—É'" style="cursor: pointer; padding: 8px; margin: 5px; background: #1a1a1a; border: 1px solid #00ff88;">
        –î–≤–∏–∂—É—â–∞—è—Å—è –∞–Ω–∏–º–∞—Ü–∏—è
      </div>
      <div class="example" onclick="document.getElementById('neuroPrompt').value = '–°–¥–µ–ª–∞–π –∏–≥—Ä—É –≥–¥–µ –Ω—É–∂–Ω–æ –∏–∑–±–µ–≥–∞—Ç—å –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π'" style="cursor: pointer; padding: 8px; margin: 5px; background: #1a1a1a; border: 1px solid #00ff88;">
        –ò–≥—Ä–∞ —Å –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è–º–∏
      </div>
    </div>
  </div>
</div>

<script src="script.js"></script>
<script>
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
  const firebaseConfig = {
    databaseURL: "https://cbonline-7a531-default-rtdb.firebaseio.com/"
  };
  
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Firebase
  firebase.initializeApp(firebaseConfig);
  const database = firebase.database();
  
  // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
  let communityImages = {};
  
  function showCommunity() {
    document.getElementById('community').style.display = 'block';
    loadCommunityProjects();
  }
  
  function hideCommunity() {
    document.getElementById('community').style.display = 'none';
  }
  
  function showNeuroGenerator() {
    document.getElementById('neuroGenerator').style.display = 'block';
    document.getElementById('neuroPrompt').focus();
  }
  
  function hideNeuroGenerator() {
    document.getElementById('neuroGenerator').style.display = 'none';
    document.getElementById('neuroStatus').textContent = '';
  }
  
  function publishProject() {
    const projectName = document.getElementById('projectName').value.trim();
    const authorName = document.getElementById('authorName').value.trim();
    const description = document.getElementById('projectDescription').value.trim();
    const code = document.getElementById('code').value;
    
    if (!projectName || !authorName || !code) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞, –∏–º—è –∞–≤—Ç–æ—Ä–∞ –∏ –∫–æ–¥');
      return;
    }
    
    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ script.js
    const currentImages = getCurrentImages();
    
    const projectData = {
      name: projectName,
      author: authorName,
      description: description,
      code: code,
      images: currentImages,
      timestamp: Date.now(),
      likes: 0
    };
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ–µ–∫—Ç –≤ Firebase
    const newProjectRef = database.ref('projects').push();
    newProjectRef.set(projectData)
      .then(() => {
        alert('–ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω!');
        document.getElementById('projectName').value = '';
        document.getElementById('authorName').value = '';
        document.getElementById('projectDescription').value = '';
        loadCommunityProjects();
      })
      .catch((error) => {
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏: ' + error.message);
      });
  }
  
  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–∑ script.js
  function getCurrentImages() {
    // –ï—Å–ª–∏ images –¥–æ—Å—Ç—É–ø–Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ—ë
    if (typeof images !== 'undefined') {
      return images;
    }
    // –ò–Ω–∞—á–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç–æ–π –æ–±—ä–µ–∫—Ç
    return {};
  }
  
  function generateWithAI() {
    const prompt = document.getElementById('neuroPrompt').value.trim();
    const addComments = document.getElementById('addComments').checked;
    const addDemoImages = document.getElementById('addDemoImages').checked;
    const complexity = document.getElementById('complexityLevel').value;
    
    if (!prompt) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–ø–∏—à–∏—Ç–µ –∫–∞–∫–æ–π –ø—Ä–æ–µ–∫—Ç –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–æ–∑–¥–∞—Ç—å');
      return;
    }
    
    const statusElement = document.getElementById('neuroStatus');
    const generateBtn = document.getElementById('generateBtn');
    
    generateBtn.disabled = true;
    statusElement.textContent = 'ü§ñ –ù–µ–π—Ä–æ—Å–µ—Ç—å –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–æ–µ–∫—Ç...';
    statusElement.style.color = '#00ccff';
    
    // –ò–º–∏—Ç–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã –Ω–µ–π—Ä–æ—Å–µ—Ç–∏ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
    setTimeout(() => {
      try {
        const generatedCode = generateProjectCode(prompt, complexity, addComments);
        
        // –í—Å—Ç–∞–≤–ª—è–µ–º —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä
        document.getElementById('code').value = generatedCode;
        
        // –î–æ–±–∞–≤–ª—è–µ–º –¥–µ–º–æ-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
        if (addDemoImages && typeof images !== 'undefined') {
          addDemoImagesToProject();
        }
        
        statusElement.textContent = '‚úÖ –ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω! –ú–æ–∂–µ—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å –µ–≥–æ.';
        statusElement.style.color = '#00ff88';
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã–≤–∞–µ–º –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
        setTimeout(() => {
          hideNeuroGenerator();
        }, 2000);
        
      } catch (error) {
        statusElement.textContent = '‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: ' + error.message;
        statusElement.style.color = '#ff4444';
      } finally {
        generateBtn.disabled = false;
      }
    }, 1500);
  }
  
  function generateProjectCode(prompt, complexity, addComments) {
    const promptLower = prompt.toLowerCase();
    
    // –ë–∞–∑–æ–≤—ã–µ —à–∞–±–ª–æ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –∫–æ–¥–∞ DimScript
    const templates = {
      // –ö–Ω–æ–ø–∫–∏ –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
      '–∫–Ω–æ–ø–∫': `print "–ü—Ä–æ–µ–∫—Ç —Å –∫–Ω–æ–ø–∫–∞–º–∏"
button 100 100 "–ù–∞–∂–º–∏ –º–µ–Ω—è" alert "–ö–Ω–æ–ø–∫–∞ –Ω–∞–∂–∞—Ç–∞!"
button 250 100 "–ò–∑–º–µ–Ω–∏ —Ü–≤–µ—Ç" color button1 #ff0000
button 400 100 "–°–¥–≤–∏–Ω—å –≤–ø—Ä–∞–≤–æ" x button2 50

text status 100 200 "–°—Ç–∞—Ç—É—Å: –≥–æ—Ç–æ–≤" #00ff88
set counter = 0`,

      // –ü–ª–∞—Ç—Ñ–æ—Ä–º–µ—Ä—ã
      '–ø–ª–∞—Ç—Ñ–æ—Ä–º': `print "–ü–ª–∞—Ç—Ñ–æ—Ä–º–µ—Ä –∏–≥—Ä–∞"
set score = 0
set gravity = 1
set jump_power = -15
set player_y_vel = 0

// –ò–≥—Ä–æ–∫
circle player 100 300 20 #ff0000

// –ü–ª–∞—Ç—Ñ–æ—Ä–º—ã
rect platform1 50 350 200 20 #00ff00
rect platform2 300 400 150 20 #00ff00
rect platform3 200 250 100 20 #00ff00

// –ú–æ–Ω–µ—Ç—ã
circle coin1 150 280 10 #ffff00
circle coin2 350 370 10 #ffff00

text score_text 20 20 "–û—á–∫–∏: 0" #ffffff

forever
  // –ì—Ä–∞–≤–∏—Ç–∞—Ü–∏—è
  set player_y_vel = player_y_vel + gravity
  y player player_y_vel
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º–∏
  if player_y_vel > 0
    if check_collision(player, platform1) or check_collision(player, platform2) or check_collision(player, platform3)
      set player_y_vel = 0
      y player 0
    endif
  endif
  
  // –°–±–æ—Ä –º–æ–Ω–µ—Ç
  if check_collision(player, coin1)
    remove coin1
    set score = score + 1
    print score
    text score_text 20 20 "–û—á–∫–∏: $score" #ffffff
  endif
  
  if check_collision(player, coin2)
    remove coin2
    set score = score + 1
    print score
    text score_text 20 20 "–û—á–∫–∏: $score" #ffffff
  endif
  
  wait 20
end`,

      // –ê–Ω–∏–º–∞—Ü–∏–∏
      '–∞–Ω–∏–º–∞—Ü': `print "–ê–Ω–∏–º–∞—Ü–∏—è –¥–≤–∏–∂–µ–Ω–∏—è"
set pos_x = 100
set pos_y = 200
set direction = 1

circle ball 100 200 30 #00ccff
rect wall 500 150 20 200 #888888

forever
  set pos_x = pos_x + (3 * direction)
  move ball pos_x pos_y
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å–æ —Å—Ç–µ–Ω–æ–π
  if pos_x >= 470
    set direction = -1
  endif
  if pos_x <= 30
    set direction = 1
  endif
  
  wait 30
end`,

      // –ò–≥—Ä—ã —Å –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è–º–∏
      '–ø—Ä–µ–ø—è—Ç—Å—Ç–≤': `print "–ò–∑–±–µ–≥–∞–π –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π!"
set score = 0
set game_speed = 5

circle player 200 300 25 #00ff88
rect obstacle 400 275 30 50 #ff0000

text score_display 20 20 "–°—á–µ—Ç: 0" #ffffff

forever
  // –î–≤–∏–∂–µ–Ω–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
  x obstacle -game_speed
  
  // –ï—Å–ª–∏ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ —É—à–ª–æ –∑–∞ —ç–∫—Ä–∞–Ω
  if get_x(obstacle) < -50
    move obstacle 450 275
    set score = score + 1
    text score_display 20 20 "–°—á–µ—Ç: $score" #ffffff
    set game_speed = game_speed + 0.2
  endif
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è
  if check_collision(player, obstacle)
    alert "–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –°—á–µ—Ç: $score"
    set score = 0
    set game_speed = 5
    move obstacle 450 275
    text score_display 20 20 "–°—á–µ—Ç: 0" #ffffff
  endif
  
  wait 20
end`,

      // –ü—Ä–æ—Å—Ç—ã–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
      '–∏–Ω—Ç–µ—Ä–∞–∫—Ç': `print "–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –ø—Ä–æ–µ–∫—Ç"
set color_index = 0
set colors = "#ff0000 #00ff00 #0000ff #ffff00 #ff00ff"

circle interactive_circle 300 250 40 #ff0000
button 250 350 "–°–º–µ–Ω–∏—Ç—å —Ü–≤–µ—Ç" change_color
button 350 350 "–£–≤–µ–ª–∏—á–∏—Ç—å" size interactive_circle 60 60
button 450 350 "–£–º–µ–Ω—å—à–∏—Ç—å" size interactive_circle 30 30

forever
  wait 100
end`,

      // –ü—Ä–æ–µ–∫—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–ø—Ä–æ—Å—Ç—ã–µ)
      'default': `print "–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç"
button 200 200 "–ú–æ—è –∫–Ω–æ–ø–∫–∞" alert "–ö–Ω–æ–ø–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç!"
text info 200 250 "–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω –Ω–µ–π—Ä–æ—Å–µ—Ç—å—é" #00ff88

// –î–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–π –∫–æ–¥ –∑–¥–µ—Å—å
set counter = 0
forever
  set counter = counter + 1
  wait 1000
end`
    };

    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –ø—Ä–æ–µ–∫—Ç–∞
    let projectType = 'default';
    
    if (promptLower.includes('–∫–Ω–æ–ø–∫') || promptLower.includes('–Ω–∞–∂–∞—Ç') || promptLower.includes('–∫–ª–∏–∫')) {
      projectType = '–∫–Ω–æ–ø–∫';
    } else if (promptLower.includes('–ø–ª–∞—Ç—Ñ–æ—Ä–º') || promptLower.includes('–ø—Ä—ã–∂–∫') || promptLower.includes('–º–æ–Ω–µ—Ç')) {
      projectType = '–ø–ª–∞—Ç—Ñ–æ—Ä–º';
    } else if (promptLower.includes('–∞–Ω–∏–º–∞—Ü') || promptLower.includes('–¥–≤–∏–∂–µ–Ω') || promptLower.includes('–ø–µ—Ä–µ–º–µ—â')) {
      projectType = '–∞–Ω–∏–º–∞—Ü';
    } else if (promptLower.includes('–ø—Ä–µ–ø—è—Ç—Å—Ç–≤') || promptLower.includes('–≤—Ä–∞–≥') || promptLower.includes('–∏–∑–±–µ–≥–∞')) {
      projectType = '–ø—Ä–µ–ø—è—Ç—Å—Ç–≤';
    } else if (promptLower.includes('–∏–Ω—Ç–µ—Ä–∞–∫—Ç') || promptLower.includes('–≤–∑–∞–∏–º–æ–¥') || promptLower.includes('–∏–∑–º–µ–Ω–µ–Ω')) {
      projectType = '–∏–Ω—Ç–µ—Ä–∞–∫—Ç';
    }

    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–æ–¥
    let code = templates[projectType] || templates['default'];
    
    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Å–ª–æ–∂–Ω–æ—Å—Ç—å
    if (complexity === 'simple') {
      code = code.replace(/wait \d+/g, 'wait 50');
      code = code.replace(/set game_speed = \d+/g, 'set game_speed = 3');
    } else if (complexity === 'complex') {
      code = code.replace(/wait \d+/g, 'wait 10');
      code = code.replace(/set game_speed = \d+/g, 'set game_speed = 8');
      // –î–æ–±–∞–≤–ª—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
      if (projectType === '–ø—Ä–µ–ø—è—Ç—Å—Ç–≤') {
        code = code.replace('rect obstacle', 'rect obstacle1');
        code += '\nrect obstacle2 600 325 30 50 #ff5500\n';
      }
    }

    // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
    if (addComments) {
      const commentHeader = `// ==============================================
// üß† –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ –Ω–µ–π—Ä–æ—Å–µ—Ç—å—é DimScript
// –ó–∞–ø—Ä–æ—Å: "${prompt}"
// –¢–∏–ø: ${projectType}
// –°–ª–æ–∂–Ω–æ—Å—Ç—å: ${complexity}
// ==============================================

`;
      code = commentHeader + code;
    }

    return code;
  }
  
  function addDemoImagesToProject() {
    // –ü—Ä–æ—Å—Ç—ã–µ SVG –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ base64
    const demoImages = {
      'player': 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiIGZpbGw9IiNmZjAwMDAiLz4KPC9zdmc+',
      'coin': 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAgMCAyMCAyMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTAiIGN5PSIxMCIgcj0iMTAiIGZpbGw9IiNmZmZmMDAiLz4KPC9zdmc+',
      'obstacle': 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAiIGhlaWdodD0iNTAiIHZpZXdCb3g9IjAgMCAzMCA1MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjMwIiBoZWlnaHQ9IjUwIiBmaWxsPSIjZmYwMDAwIi8+Cjwvc3ZnPg=='
    };
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    for (const [name, dataUrl] of Object.entries(demoImages)) {
      images[name] = dataUrl;
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –≥–∞–ª–µ—Ä–µ—é
    if (typeof updateImageGallery === 'function') {
      updateImageGallery();
    }
  }
  
  function loadCommunityProjects() {
    const projectsContainer = document.getElementById('projectsContainer');
    projectsContainer.innerHTML = '<div>–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤...</div>';
    
    database.ref('projects').orderByChild('timestamp').once('value')
      .then((snapshot) => {
        projectsContainer.innerHTML = '';
        
        if (!snapshot.exists()) {
          projectsContainer.innerHTML = '<div>–ü–æ–∫–∞ –Ω–µ—Ç –ø—Ä–æ–µ–∫—Ç–æ–≤. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</div>';
          return;
        }
        
        const projects = [];
        snapshot.forEach((childSnapshot) => {
          projects.push({
            id: childSnapshot.key,
            ...childSnapshot.val()
          });
        });
        
        // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (–Ω–æ–≤—ã–µ —Å–Ω–∞—á–∞–ª–∞)
        projects.sort((a, b) => b.timestamp - a.timestamp);
        
        projects.forEach((project) => {
          const projectElement = document.createElement('div');
          projectElement.className = 'community-project';
          projectElement.style.border = '1px solid #00ff88';
          projectElement.style.padding = '15px';
          projectElement.style.margin = '10px 0';
          projectElement.style.background = '#111';
          
          projectElement.innerHTML = `
            <h4>${project.name}</h4>
            <div><strong>–ê–≤—Ç–æ—Ä:</strong> ${project.author}</div>
            <div><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> ${project.description || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è'}</div>
            <div><strong>–î–∞—Ç–∞:</strong> ${new Date(project.timestamp).toLocaleString()}</div>
            <div><strong>–õ–∞–π–∫–æ–≤:</strong> ${project.likes || 0}</div>
            <button onclick="loadProject('${project.id}')" style="margin-top: 10px;">üìù –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–µ–∫—Ç</button>
            <button onclick="likeProject('${project.id}', ${project.likes || 0})" style="margin-top: 10px;">‚ù§Ô∏è –õ–∞–π–∫</button>
          `;
          
          projectsContainer.appendChild(projectElement);
        });
      })
      .catch((error) => {
        projectsContainer.innerHTML = `<div>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}</div>`;
      });
  }
  
  function loadProject(projectId) {
    database.ref('projects/' + projectId).once('value')
      .then((snapshot) => {
        const project = snapshot.val();
        if (project) {
          document.getElementById('code').value = project.code || '';
          
          // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
          communityImages = project.images || {};
          
          hideCommunity();
          alert('–ü—Ä–æ–µ–∫—Ç –∑–∞–≥—Ä—É–∂–µ–Ω! –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å –µ–≥–æ.');
          
          // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –º–µ–Ω–µ–¥–∂–µ—Ä–µ –∫–∞—Ä—Ç–∏–Ω–æ–∫
          if (typeof updateImageGallery === 'function') {
            // –ö–æ–ø–∏—Ä—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –æ–±—ä–µ–∫—Ç images
            if (typeof images !== 'undefined' && project.images) {
              for (const key in project.images) {
                images[key] = project.images[key];
              }
              updateImageGallery();
            }
          }
        }
      })
      .catch((error) => {
        alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞: ' + error.message);
      });
  }
  
  function likeProject(projectId, currentLikes) {
    database.ref('projects/' + projectId + '/likes').set((currentLikes || 0) + 1)
      .then(() => {
        loadCommunityProjects(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
      })
      .catch((error) => {
        alert('–û—à–∏–±–∫–∞: ' + error.message);
      });
  }
</script>
</body>
</html>